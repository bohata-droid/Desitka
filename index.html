<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Hra: Des√≠tka</title>
  <style>
    /* === CEL√Å STR√ÅNKA === */

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: flex-start;       /* naho≈ôe */
      height: 100vh;                 /* p≈ôesnƒõ v√Ω≈°ka okna */
      width: 100vw;                  /* p≈ôesnƒõ ≈°√≠≈ôka okna */
      overflow: hidden;              /* nic nevyteƒçe ven */
      margin: 0;
      padding: 0;
    }

    /* === HLAVN√ç BLOK HRY === */

    .game {
      background: #ffffff;
      padding: 16px 18px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);

      width: min(600px, 95vw);       /* p≈ôizp≈Øsoben√≠ ≈°√≠≈ôce okna */
      height: auto;
      max-height: 100vh;             /* nikdy nep≈ôes√°hne v√Ω≈°ku okna */

      overflow-y: auto;              /* pokud je okno mal√©, scrolluje se jen uvnit≈ô hry */

      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }

    /* === NADPISY === */

    h1 {
      font-size: clamp(20px, 3vh, 28px);
      margin-top: 0;
      margin-bottom: 6px;
      text-align: center;
    }

    .subtitle {
      margin-top: 0;
      margin-bottom: 12px;
      color: #555;
      font-size: clamp(13px, 2vh, 16px);
      text-align: center;
    }

    /* === KARTY === */

    .cards-wrapper {
      position: relative;
      margin-bottom: 6px;
      flex: 0 0 auto;
    }

    .cards {
      display: flex;
      gap: 8px;
      justify-content: space-between;
      margin: 10px 0 10px;
    }

    .card {
      flex: 1;
      background: #fafafa;
      border-radius: 12px;
      border: 2px solid #ddd;

      font-size: 60px;       /* v√Ωchoz√≠, pak se p≈ôepoƒç√≠t√° v JS */
      font-weight: 700;

      display: flex;
      justify-content: center;
      align-items: center;

      aspect-ratio: 2.2 / 3.5;        /* karta na v√Ω≈°ku */
      padding: 0;
      box-sizing: border-box;
    }

    /* === OVERLAY P≈òI √öSPƒöCHU === */

    .success-overlay {
      position: absolute;
      inset: 0;
      border-radius: 14px;
      background: rgba(6, 95, 70, 0.95);
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: pointer;
      padding: 12px;
      z-index: 5;
    }

    .success-overlay strong {
      display: block;
      font-size: clamp(18px, 3vh, 24px);
      margin-bottom: 4px;
    }

    .success-overlay span {
      font-size: clamp(12px, 2vh, 16px);
      opacity: 0.9;
    }

    /* === TIMER + √öSPƒöCHY + P≈òEP√çNAƒåE === */

    .timer-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 8px;
      font-size: clamp(12px, 2vh, 15px);
      color: #374151;
      flex: 0 0 auto;
    }

    .timer-left {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      user-select: none;
    }

    .toggle input {
      cursor: pointer;
    }

    .timer-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
    }

    .timer-display {
      font-weight: 600;
    }

    .success-display,
    .failure-display {
      font-weight: 600;
      font-size: clamp(14px, 2.2vh, 18px);  /* stejn√© jako tlaƒç√≠tka */
      color: #15803d;
    }

    .failure-display {
      color: #b91c1c;
    }

    /* === VSTUPN√ç POLE === */

    label[for="expression"] {
      font-size: clamp(13px, 2vh, 16px);
      display: block;
      margin-bottom: 4px;
      color: #333;
      flex: 0 0 auto;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: clamp(14px, 2.2vh, 18px);
      box-sizing: border-box;
      flex: 0 0 auto;
    }

    /* === KL√ÅVESNICE === */

    .keypad {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 10px;
      flex: 0 0 auto;
    }

    .keypad button {
      padding: 10px 0;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: clamp(14px, 2.2vh, 18px);
      cursor: pointer;
    }

    .keypad button.operator {
      font-weight: 600;
    }

    .keypad button.action {
      background: #e5e7eb;
      font-size: clamp(12px, 2vh, 15px);
    }

    /* === TLAƒå√çTKA === */

    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex: 0 0 auto;
    }

    button {
      flex: 1;
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: clamp(14px, 2.2vh, 18px);
      font-weight: 600;
    }

    button.check {
      background: #2563eb;
      color: white;
    }

    button.have {
      background: #22c55e;
      color: white;
    }

    button.new {
      background: #e5e7eb;
      color: #111827;
    }

    .message {
      margin-top: 10px;
      font-size: clamp(13px, 2vh, 16px);
      min-height: 20px;
      text-align: center;
      flex: 0 0 auto;
    }

    .message.ok {
      color: #16a34a;
    }

    .message.error {
      color: #dc2626;
    }

    .show-failed {
      margin-top: 8px;
      align-self: center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      cursor: pointer;
      font-size: clamp(12px, 2vh, 14px);
    }
  </style>
</head>
<body>
  <div class="game">
    <h1>Vyjde 10?</h1>
    <p class="subtitle">
      Z tƒõchto ƒçty≈ô ƒç√≠sel vytvo≈ôte matematick√Ω v√Ωraz, kter√Ω m√° v√Ωsledek <strong>10</strong>.<br>
      Mus√≠te pou≈æ√≠t <strong>v≈°echny karty</strong>. M≈Ø≈æete je spojovat jako ƒç√≠slice do dvojm√≠stn√Ωch ƒç√≠sel (nap≈ô. 1 a 4 ‚Üí 14).
    </p>

    <div class="cards-wrapper">
      <div class="cards" id="cards"></div>

      <!-- zelen√© pole p≈ôes karty p≈ôi √∫spƒõchu -->
      <div class="success-overlay" id="successOverlay">
        <div>
          <strong>Spr√°vnƒõ! V√Ωsledek je 10 üéâ</strong>
          <span>Kliknƒõte pro pokraƒçov√°n√≠.</span>
        </div>
      </div>
    </div>

    <!-- ƒçasovaƒç, p≈ôep√≠naƒçe a poƒçitadla -->
    <div class="timer-row">
      <div class="timer-left">
        <label class="toggle">
          <input type="checkbox" id="timerToggle" checked>
          <span>ƒåasovaƒç</span>
        </label>
        <label class="toggle">
          <input type="checkbox" id="keypadToggle" unchecked>
          <span>Kl√°vesnice</span>
        </label>
      </div>
      <div class="timer-right">
        <div class="timer-display" id="timerDisplay">ƒåas: 0:00</div>
        <div class="success-display" id="successDisplay">√öspƒõchy: 0</div>
        <div class="failure-display" id="failureDisplay">Ne√∫spƒõchy: 0</div>
      </div>
    </div>

    <label for="expression">
      Zapi≈°te v√Ωraz (pou≈æijte +, -, *, / a z√°vorky):
    </label>
    <input type="text" id="expression" placeholder="nap≈ô. (3+7) nebo 2*5">

    <!-- Dotykov√° kl√°vesnice -->
    <div class="keypad" id="keypad">
      <!-- ≈ô√°dek 1 -->
      <button type="button" data-value="7">7</button>
      <button type="button" data-value="8">8</button>
      <button type="button" data-value="9">9</button>
      <button type="button" class="operator" data-value="+">+</button>

      <!-- ≈ô√°dek 2 -->
      <button type="button" data-value="4">4</button>
      <button type="button" data-value="5">5</button>
      <button type="button" data-value="6">6</button>
      <button type="button" class="operator" data-value="-">‚àí</button>

      <!-- ≈ô√°dek 3 -->
      <button type="button" data-value="1">1</button>
      <button type="button" data-value="2">2</button>
      <button type="button" data-value="3">3</button>
      <button type="button" class="operator" data-value="*">√ó</button>

      <!-- ≈ô√°dek 4 -->
      <button type="button" data-value="0">0</button>
      <button type="button" data-value="(">(</button>
      <button type="button" data-value=")">)</button>
      <button type="button" class="operator" data-value="/">√∑</button>

      <!-- ≈ô√°dek 5 -->
      <button type="button" class="action" data-action="clear">C</button>
      <button type="button" class="action" data-action="backspace">‚å´</button>
      <button type="button" disabled></button>
      <button type="button" disabled></button>
    </div>

    <div class="buttons">
      <button class="check" id="checkBtn">Zkontrolovat</button>
      <button class="have" id="haveBtn">M√°m</button>
      <button class="new" id="newCardsBtn">Nov√© karty</button>
    </div>

    <div class="message" id="message"></div>

    <button class="show-failed" id="showFailedBtn">Ne√∫spƒõ≈°n√© √∫lohy</button>
  </div>

  <script>
    let currentCards = [];

    // ƒçasovaƒç
    let timerEnabled = true;
    let timerInterval = null;
    let startTime = null;

    // kl√°vesnice
    let keypadEnabled = true;

    // poƒçitadla
    let successCount = 0;
    let failureCount = 0;
    let roundSolved = false;          // jestli byla aktu√°ln√≠ √∫loha √∫spƒõ≈°nƒõ vy≈ôe≈°ena (‚Äûspr√°vnƒõ‚Äú nebo ‚Äûm√°m‚Äú)
    let failedPuzzles = [];           // pole ƒçtve≈ôic nevy≈ôe≈°en√Ωch √∫loh

    // ===== GENEROV√ÅN√ç KARET =====

    function generateCards() {
      currentCards = [];
      for (let i = 0; i < 4; i++) {
        const n = Math.floor(Math.random() * 10) + 1; // 1..10
        currentCards.push(n);
      }
      renderCards();
      clearResult();

      const input = document.getElementById('expression');
      input.value = '';

      hideSuccessOverlay();
      roundSolved = false;           // nov√° √∫loha, zat√≠m nevy≈ôe≈°en√°
      resetTimerForNewRound();
    }

    function renderCards() {
      const cardsDiv = document.getElementById('cards');
      cardsDiv.innerHTML = '';
      currentCards.forEach(num => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = num;
        cardsDiv.appendChild(div);
      });

      // Po vykreslen√≠ p≈ôepoƒç√≠t√°me velikost ƒç√≠sel na kart√°ch
      requestAnimationFrame(fitCardFonts);
    }

    // ===== DYNAMICK√â ZVƒöT≈†EN√ç ƒå√çSEL NA KART√ÅCH =====
    // Najdeme nejvƒõt≈°√≠ font-size, kter√° se vejde do v≈°ech karet,
    // a tu nastav√≠me v≈°em (aby byla ƒç√≠sla stejnƒõ velk√°).

    function fitCardFonts() {
      const cards = document.querySelectorAll('.card');
      if (!cards.length) return;

      // vytvo≈ô√≠me testovac√≠ element mimo obrazovku
      const test = document.createElement('div');
      test.style.position = 'fixed';
      test.style.left = '-9999px';
      test.style.top = '-9999px';
      test.style.whiteSpace = 'nowrap';
      test.style.fontWeight = '700';
      document.body.appendChild(test);

      let maxFont = Infinity;

      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        if (!rect.width || !rect.height) return;

        const text = card.textContent.trim() || '0';

        // velk√Ω start ‚Äì 90 % v√Ω≈°ky karty
        let font = rect.height * 0.9;

        test.textContent = text;

        // zmen≈°ujeme, dokud se text nevejde
        while (font > 5) {
          test.style.fontSize = font + 'px';

          if (
            test.offsetWidth <= rect.width * 0.9 &&
            test.offsetHeight <= rect.height * 0.9
          ) {
            break;
          }

          font -= 2;
        }

        maxFont = Math.min(maxFont, font);
      });

      if (!isFinite(maxFont) || maxFont <= 0) {
        test.remove();
        return;
      }

      cards.forEach(card => {
        card.style.fontSize = maxFont + 'px';
      });

      test.remove();
    }

    window.addEventListener('resize', () => {
      fitCardFonts();
    });

    function clearResult() {
      const msg = document.getElementById('message');
      msg.textContent = '';
      msg.className = 'message';
    }

    // ===== ƒåASOVAƒå =====

    function updateTimerDisplay() {
      const display = document.getElementById('timerDisplay');

      if (!timerEnabled) {
        display.textContent = 'ƒåasovaƒç vypnut√Ω';
        return;
      }
      if (!startTime) {
        display.textContent = 'ƒåas: 0:00';
        return;
      }

      const elapsedMs = Date.now() - startTime;
      const totalSec = Math.floor(elapsedMs / 1000);
      const minutes = Math.floor(totalSec / 60);
      const seconds = totalSec % 60;

      display.textContent = 'ƒåas: ' + minutes + ':' + String(seconds).padStart(2, '0');
    }

    function startTimer() {
      if (!timerEnabled) return;
      stopTimer();
      startTime = Date.now();
      updateTimerDisplay();
      timerInterval = setInterval(updateTimerDisplay, 100);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function resetTimerForNewRound() {
      const display = document.getElementById('timerDisplay');
      if (!timerEnabled) {
        stopTimer();
        startTime = null;
        display.textContent = 'ƒåasovaƒç vypnut√Ω';
      } else {
        startTimer();
      }
    }

    // ===== POU≈ΩIT√ç KARET =====

    function getNumberCounts(nums) {
      const counts = {};
      nums.forEach(n => {
        counts[n] = (counts[n] || 0) + 1;
      });
      return counts;
    }

    function canMatchNumbersWithCards(exprNumbers, cardCounts) {
      const nums = [...exprNumbers].sort((a, b) => b - a); // nejd≈ô√≠v vƒõt≈°√≠

      function helper(index, counts) {
        if (index === nums.length) {
          // pou≈æili jsme v≈°echna ƒç√≠sla z v√Ωrazu, zbyly nƒõjak√© karty?
          for (const v in counts) {
            if (counts[v] > 0) return false;  // karta nevyu≈æita -> neplatn√©
          }
          return true;
        }

        const target = nums[index];

        // 1) karta p≈ô√≠mo jako ƒç√≠slo (nap≈ô. 10 -> karta 10)
        if (counts[target] && counts[target] > 0) {
          counts[target]--;
          if (helper(index + 1, counts)) return true;
          counts[target]++; // zpƒõt
        }

        // 2) slo≈æen√≠ dvojcifern√©ho ƒç√≠sla ze dvou jednocifern√Ωch karet
        if (target >= 10 && target <= 99) {
          for (let d1 = 1; d1 <= 9; d1++) {
            for (let d2 = 1; d2 <= 9; d2++) {
              if (10 * d1 + d2 !== target) continue;

              const need1 = (d1 === d2) ? 2 : 1;
              if (!counts[d1] || counts[d1] < need1) continue;
              if (d1 !== d2 && (!counts[d2] || counts[d2] < 1)) continue;

              counts[d1] -= need1;
              if (d1 !== d2) counts[d2] -= 1;

              if (helper(index + 1, counts)) return true;

              counts[d1] += need1;
              if (d1 !== d2) counts[d2] += 1;
            }
          }
        }

        return false;
      }

      return helper(0, { ...cardCounts });
    }

    function usesOnlyCards(expression) {
      const matches = expression.match(/\d+/g);
      if (!matches) return false;

      const exprNumbers = matches.map(x => parseInt(x, 10));
      const cardCounts = getNumberCounts(currentCards);

      return canMatchNumbersWithCards(exprNumbers, cardCounts);
    }

    // ===== POƒå√çTADLA =====

    function updateSuccessDisplay() {
      const el = document.getElementById('successDisplay');
      el.textContent = '√öspƒõchy: ' + successCount;
    }

    function updateFailureDisplay() {
      const el = document.getElementById('failureDisplay');
      el.textContent = 'Ne√∫spƒõchy: ' + failureCount;
    }

    function registerSuccess(showOverlay) {
      successCount++;
      roundSolved = true;
      updateSuccessDisplay();

      stopTimer();
      updateTimerDisplay();

      const msg = document.getElementById('message');
      msg.className = 'message ok';

      if (showOverlay) {
        msg.textContent = '';
        showSuccessOverlay();
      } else {
        msg.textContent = 'Pokus ‚Äûm√°m‚Äú byl zaznamen√°n jako √∫spƒõ≈°n√Ω.';
      }
    }

    function showSuccessOverlay() {
      const overlay = document.getElementById('successOverlay');
      overlay.style.display = 'flex';
    }

    function hideSuccessOverlay() {
      const overlay = document.getElementById('successOverlay');
      overlay.style.display = 'none';
    }

    // ===== KONTROLA V√ùRAZU =====

    function checkExpression() {
      const input = document.getElementById('expression');
      const msg = document.getElementById('message');
      const expr = input.value.trim();

      clearResult();
      hideSuccessOverlay();

      if (!expr) {
        msg.textContent = 'Napi≈° nƒõjak√Ω v√Ωraz.';
        msg.classList.add('error');
        return;
      }

      const safeRegex = /^[0-9+\-*/()\s]+$/;
      if (!safeRegex.test(expr)) {
        msg.textContent = 'V√Ωraz m≈Ø≈æe obsahovat jen ƒç√≠sla, +, -, *, /, z√°vorky a mezery.';
        msg.classList.add('error');
        return;
      }

      if (!usesOnlyCards(expr)) {
        msg.textContent = 'Mus√≠te pou≈æ√≠t v≈°echny karty (m≈Ø≈æete je spojovat do dvojm√≠stn√Ωch ƒç√≠sel).';
        msg.classList.add('error');
        return;
      }

      let result;
      try {
        const fn = new Function('return (' + expr + ');');
        result = fn();
      } catch (e) {
        msg.textContent = 'V√Ωraz nen√≠ platn√Ω. Zkuste to znovu.';
        msg.classList.add('error');
        return;
      }

      if (typeof result !== 'number' || !isFinite(result)) {
        msg.textContent = 'V√Ωraz ned√°v√° ƒç√≠seln√Ω v√Ωsledek.';
        msg.classList.add('error');
        return;
      }

      const EPS = 1e-9;
      if (Math.abs(result - 10) < EPS) {
        // √∫spƒõch P≈òESN√ùM V√ùRAZEM -> overlay se zobraz√≠
        registerSuccess(true);
      } else {
        msg.textContent = 'Bohu≈æel, v√Ωsledek je ' + result + ', ne 10.';
        msg.classList.add('error');
      }
    }

    // ===== TLAƒå√çTKO ‚ÄûM√°m‚Äú =====

    function handleHaveClick() {
      hideSuccessOverlay();
      if (!roundSolved) {
        registerSuccess(false); // bez zelen√©ho okna p≈ôes karty
      }
    }

    // ===== NOV√â KARTY (poƒç√≠t√°n√≠ ne√∫spƒõch≈Ø) =====

    function handleNewCards() {
      // Pokud aktu√°ln√≠ √∫loha nebyla vy≈ôe≈°ena (ani ‚Äûm√°m‚Äú), poƒç√≠t√° se jako ne√∫spƒõch
      if (!roundSolved && currentCards.length === 4) {
        failureCount++;
        updateFailureDisplay();
        // ulo≈æ√≠me si tuto ƒçtve≈ôici jako ne√∫spƒõ≈°nou
        failedPuzzles.push([...currentCards]);
      }
      generateCards();
    }

    // ===== NE√öSPƒö≈†N√â √öLOHY =====

    function showFailedPuzzles() {
      if (!failedPuzzles.length) {
        alert('Zat√≠m ≈æ√°dn√© ne√∫spƒõ≈°n√© √∫lohy.');
        return;
      }

      let lines = failedPuzzles.map((cards, idx) => {
        return (idx + 1) + '. ' + cards.join(', ');
      });

      alert('Ne√∫spƒõ≈°n√© √∫lohy:\n\n' + lines.join('\n'));
    }

    // ===== KL√ÅVESNICE =====

    function initKeypad() {
      const keypad = document.getElementById('keypad');
      const input = document.getElementById('expression');

      keypad.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;

        const action = btn.dataset.action;
        const value = btn.dataset.value;

        if (action === 'clear') {
          input.value = '';
        } else if (action === 'backspace') {
          input.value = input.value.slice(0, -1);
        } else if (value) {
          input.value += value;
        }

        input.focus();
      });
    }

    function updateKeypadVisibility() {
      const keypad = document.getElementById('keypad');
      keypad.style.display = keypadEnabled ? 'grid' : 'none';
    }

    // ===== INIT P≈òEP√çNAƒå≈Æ =====

    function initTimerToggle() {
      const toggle = document.getElementById('timerToggle');
      timerEnabled = toggle.checked;

      toggle.addEventListener('change', () => {
        timerEnabled = toggle.checked;
        if (!timerEnabled) {
          stopTimer();
          startTime = null;
        } else {
          startTimer();
        }
        updateTimerDisplay();
      });
    }

    function initKeypadToggle() {
      const toggle = document.getElementById('keypadToggle');
      keypadEnabled = toggle.checked;
      updateKeypadVisibility();

      toggle.addEventListener('change', () => {
        keypadEnabled = toggle.checked;
        updateKeypadVisibility();
      });
    }

    function initSuccessOverlayClick() {
      const overlay = document.getElementById('successOverlay');
      overlay.addEventListener('click', () => {
        hideSuccessOverlay();
      });
    }

    // ===== START HRY =====

    function initGame() {
      initKeypad();
      initTimerToggle();
      initKeypadToggle();
      initSuccessOverlayClick();

      document.getElementById('checkBtn').addEventListener('click', checkExpression);
      document.getElementById('haveBtn').addEventListener('click', handleHaveClick);
      document.getElementById('newCardsBtn').addEventListener('click', handleNewCards);
      document.getElementById('showFailedBtn').addEventListener('click', showFailedPuzzles);

      document.getElementById('expression').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          checkExpression();
        }
      });

      updateSuccessDisplay();
      updateFailureDisplay();
      generateCards(); // prvn√≠ sada karet + start ƒçasovaƒçe
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initGame);
    } else {
      initGame();
    }
  </script>
</body>
</html>
